<h1>Геолокация при помощи HTML5 и JS</h1>
<h2>HTML5 Geolocation API</h2>
<pre>
Проверим ее наличие в браузере.
if ('geolocation' in navigator) { alert ('Да поддерживает!'); }

Работать с геолокацией нужно через объект navigator.geolocation, который содержит всего 3 метода.

navigator.geolocation.getCurrentPosition() — Определяет текущее местоположение пользователя.
navigator.geolocation.watchPosition() – Всякий раз определяет текущее местоположение пользователя, как только оно изменяется. Устройство пользователя само определяет оптимальный интервал опроса. 
navigator.geolocation.clearWatch() – Останавливает слежение за пользователем инициированное методом watchPosition.

Методы getCurrentPosition и watchPosition похожи, за исключением того, что метод watchPosition пытается следить за сменой положения пользователя и его работа напоминает функцию setInterval, только без указания времени интервала опроса, за это отвечает само устройство пользователя. Метод watchPosition возвращает идентификатор, который нужен методу clearWatch для остановки слежения.

Далее все примеры будут основаны на методе getCurrentPosition.

navigator.geolocation.getCurrentPosition(success, error[, options])
success – callback функция, которая будет вызвана при успешном определении геопозиции пользователя.
error — callback функция, которая будет вызвана при ошибке или отмене определения геопозиции пользователем.
options – необязательный параметр, который должен быть объектом с дополнительными опциями.

Объект options может содержать некоторые свойства:

enableHighAccuracy – точность определения позиции (true/false) большая точность, меньшая точность. Для задействования средств определения геопозиции с большой точностью, устройство пользователя должно быть оборудовано этими средствами. Например, в мобильных устройствах, этим средством может выступать GPS. В противном случае, никакого эффекта от переключения этого параметра не произойдет.
timeout — количество миллисекунд, которое веб-приложение будет ожидать для получения положения пользователя. Таймер не начнет отсчет, пока пользователь не даст разрешение на вычисление его положение.
maximumAge — количество миллисекунд, пока данные хранятся в кэше. То есть не требуется постоянно заново определять геопозицию пользователя, а можно быстро взять старые данные.

Функция обратного вызова success принимает объект Position, который содержит данные о геопозиции пользователя.

Position.coords.latitude — широта в виде числа;
Position. coords.longitude — долгота в виде числа;
Position.coords.accuracy — точность позиции;
Position.coords.altitude — высота в метрах над средним уровнем моря;
Position.coords.altitudeAccuracy — точность положения высоты;
Position.coords.heading — градусы по часовой стрелке от севера;
Position.coords.speed — скорость в метрах в секунду;
Position.timestamp — время отклика.

Функция обратного вызова error принимает объект PositionError, который содержит код ошибки и текстовое сообщение.

PositionError.code – код ошибки, который является цифровым значением:

1 соответствует константе PERMISSION_DENIED – пользователь отказался сообщать своё метоположение;
2 соответствует константе POSITION_UNAVAILABLE – сеть не работает, нет связи со спутниками;
3 соответствует константе TIMEOUT – работа завершилась по таймауту, определение геопозиции занимает слишком много времени.

PositionError.message – сообщение, которое не предназначено для пользователя, а больше подходит для логов.

И так. А немного кода.

function geo_success(position) { alert(position.coords.latitude+”, ”+position.coords.longitude); }
function geo_error(error) { if(error.code == PERMISSION_DENIED) alert("Местоположение не определенно"); if(error.code == POSITION_UNAVAILABLE) alert("Сеть не активна"); if(error.code == POSITION_UNAVAILABLE) alert("Превышено время ожидания");
}
var geo_options = { enableHighAccuracy : true, maximumAge : 45000, timeout  : 30000 };
navigator.geolocation.getCurrentPosition(geo_success, geo_error, geo_options);
Вот и все. Благодаря этому простому функционалу данные о геопозиции пользователя можно использовать для многих целей. Например больше не нужно хранить огромную базу интервалов IP адресов по странам и городам, да и которую ещё нужно постоянно обновлять.

</pre>